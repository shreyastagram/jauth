spring:
  application:
    name: auth-service
  
  # Profile is set via SPRING_PROFILES_ACTIVE environment variable
  # Use ./run.sh to start - it loads .env automatically
  # Or: ./run.sh dev   (for H2 development mode)
  # Or: ./run.sh prod  (for PostgreSQL production mode)
  
  # H2 Database Configuration (Development)
  datasource:
    url: jdbc:h2:mem:fixhomi_auth
    driver-class-name: org.h2.Driver
    username: sa
    password: 
  
  # H2 Console (for development/debugging)
  h2:
    console:
      enabled: true
      path: /h2-console
  
  # JPA/Hibernate Configuration
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        '[format_sql]': true
        dialect: org.hibernate.dialect.H2Dialect
    open-in-view: false

  # OAuth2 Client Configuration (Google)
  # IMPORTANT: These credentials must match those in Google Cloud Console
  # Get credentials from: https://console.cloud.google.com/apis/credentials
  # Set GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET in environment variables
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:}
            client-secret: ${GOOGLE_CLIENT_SECRET:}
            scope:
              - email
              - profile
            redirect-uri: '{baseUrl}/oauth2/callback/google'
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: email

# Google Mobile Client IDs (for React Native / iOS / Android token verification)
# These are separate OAuth clients for each mobile platform
# IMPORTANT: Set GOOGLE_IOS_CLIENT_ID and GOOGLE_ANDROID_CLIENT_ID in environment variables
google:
  ios:
    client-id: ${GOOGLE_IOS_CLIENT_ID:}
  android:
    client-id: ${GOOGLE_ANDROID_CLIENT_ID:}

# JWT Configuration
# IMPORTANT: This secret MUST match the JWT_SECRET in Node.js backend's .env file
# Both services verify the same tokens, so they need the same secret
jwt:
  secret: ${JWT_SECRET:xXbeJ9A1aU3vpD1YKHQ7tBqvOYlZqZet0pywMSHW3D4QEdDdIqnp244kqTxYjn7b1HxgfHR2Sbi6qupfAA123456}
  expiration:
    ms: 86400000  # 24 hours in milliseconds
  issuer: fixhomi-auth-service
  refresh-token:
    expiration:
      days: 7  # Refresh token validity in days

# Server Configuration
server:
  port: 8080
  servlet:
    context-path: /
  error:
    include-message: always
    include-binding-errors: always

# Logging Configuration
logging:
  level:
    '[com.fixhomi.auth]': DEBUG
    '[org.springframework.security]': DEBUG
    '[org.hibernate.SQL]': DEBUG
    '[org.hibernate.type.descriptor.sql.BasicBinder]': TRACE

# FixHomi Application Configuration
fixhomi:
  # OAuth mobile client IDs (used by GoogleAuthService for mobile token verification)
  # IMPORTANT: Set these in environment variables or .env file
  oauth:
    google:
      ios-client-id: ${GOOGLE_IOS_CLIENT_ID:}
      android-client-id: ${GOOGLE_ANDROID_CLIENT_ID:}
  
  # Verification settings
  verification:
    # OTP (Phone verification) settings
    otp:
      expiration-minutes: 5
      max-attempts: 3
      length: 6
      rate-limit-minutes: 1
      rate-limit-max-requests: 3
    
    # Email verification settings
    email:
      expiration-hours: 24
      rate-limit-minutes: 5
      # IMPORTANT: Use deployed Render URL for email links so they work on any device
      # The verification endpoint runs on Render, not localhost
      base-url: ${FIXHOMI_BASE_URL:https://jauth.onrender.com}
    
    # Password reset settings
    password-reset:
      expiration-hours: 1
      rate-limit-minutes: 5
      base-url: ${FIXHOMI_FRONTEND_URL:https://jauth.onrender.com}
  
  # Notification services configuration
  notification:
    # Email service configuration
    email:
      # Provider: 'stub' for development, 'brevo' for production
      provider: ${EMAIL_PROVIDER:stub}
      brevo:
        api-key: ${BREVO_API_KEY:}
        sender-email: ${BREVO_SENDER_EMAIL:noreply@fixhomi.com}
        sender-name: ${BREVO_SENDER_NAME:FixHomi}
    
    # SMS service configuration  
    sms:
      # Provider: 'stub' for development, 'twilio' for production
      provider: ${SMS_PROVIDER:stub}
      twilio:
        account-sid: ${TWILIO_ACCOUNT_SID:}
        auth-token: ${TWILIO_AUTH_TOKEN:}
        phone-number: ${TWILIO_PHONE_NUMBER:}
        verify-service-sid: ${TWILIO_VERIFY_SERVICE_SID:}
        # Trial mode: logs helpful info when using Twilio trial account
        trial-mode: ${TWILIO_TRIAL_MODE:true}
        # Your verified phone number (only this receives OTPs in trial mode)
        verified-phone: ${TWILIO_VERIFIED_PHONE:}

  # Rate limiting configuration
  rate-limit:
    enabled: ${RATE_LIMIT_ENABLED:true}
    auth:
      requests-per-minute: 10
    otp:
      requests-per-minute: 5
    general:
      requests-per-minute: 100
  
  # API configuration
  api:
    base-url: ${FIXHOMI_BASE_URL:http://localhost:8080}
  
  # App configuration for deep links
  app:
    deep-link-scheme: ${FIXHOMI_DEEP_LINK_SCHEME:fixhomi}
  
  # CORS configuration for security
  cors:
    # Comma-separated list of allowed origins
    allowed-origins: ${ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5001,http://localhost:8081}
  
  # Backend services URLs
  backend:
    nodejs-url: ${NODEJS_BACKEND_URL:http://localhost:5001}

# Spring Boot Actuator configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
      probes:
        enabled: true
  info:
    env:
      enabled: true

# Application info for actuator
info:
  app:
    name: FixHomi Auth Service
    description: JWT-based authentication microservice
    version: 1.0.0
  java:
    version: ${java.version}

# OpenAPI/Swagger configuration
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha
    disable-swagger-default-url: true

